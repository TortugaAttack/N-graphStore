
CREATE TABLE IF NOT EXISTS USER (
id int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
userName VARCHAR(45) NOT NULL UNIQUE,
password VARCHAR(512) NOT NULL
);

CREATE TABLE IF NOT EXISTS ROLE (
id int GENERATED BY DEFAULT AS IDENTITY (START WITH 1 INCREMENT BY 1) PRIMARY KEY,
roleName VARCHAR(45) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS USER_ROLES (
  user_id int NOT NULL,
  role_id int NOT NULL,
  PRIMARY KEY (user_id, role_id)
);

INSERT INTO USER(userName, password) 
SELECT * FROM (VALUES('admin', '$2a$11$H9SOgevdCGQV8qznkag.2OP0s9FoXLTVmuhJNePANLLoOOFspJbli') )
WHERE NOT EXISTS ( SELECT userName FROM USER 
                   WHERE userName='admin');

INSERT INTO ROLE(roleName) 
SELECT * FROM (VALUES('ROLE_ADMIN'))
WHERE NOT EXISTS ( SELECT roleName FROM ROLE 
                   WHERE roleName='ROLE_ADMIN');

INSERT INTO USER_ROLES(user_id, role_id) 
SELECT * FROM (VALUES(1, 1))
WHERE NOT EXISTS ( SELECT * FROM USER_ROLES
                   WHERE user_id='1');
